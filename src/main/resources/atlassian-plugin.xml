<?xml version="1.0" encoding="UTF-8"?>

<atlassian-plugin key="${project.groupId}.${project.artifactId}"
                  name="${project.name}"
                  plugins-version="2">

  <plugin-info>
    <description>${project.description}</description>
    <version>${project.version}</version>
    <vendor name="${project.organization.name}"
            url="${project.organization.url}" />
    <param name="configure.url">/admin/plugins/attachment-tools/configure.action</param>
  </plugin-info>

  <resource type="i18n" name="i18n" location="i18n" />

  <!--
  Workaround for versions prior 4.0.1 to allow dependency injection.
  See: https://developer.atlassian.com/display/CONFDEV/Workaround+pattern+for+autowiring+jobs
  -->
  <component key="purge-old-attachments-jobdetail"
             name="Purge attachments job-detail"
             class="com.drunkendev.confluence.plugins.attachments.PurgeOldAttachmentsJobDetail">
    <description>Confluence &lt; 4.0.1 compatible job detail.</description>
    <interface>org.quartz.JobDetail</interface>
  </component>

  <job key="purge-old-attachments-job"
       name="Purge Old Attachment Versions"
       class="com.drunkendev.confluence.plugins.attachments.PurgeOldAttachmentsJob"
       perClusterJob="false" />

  <trigger key="purge-old-attachments-trigger"
           name="Purge Old Attachments Trigger">
    <job key="purge-old-attachments-jobdetail" />
    <!-- Run once a day -->
    <schedule cron-expression="0 0 0 * * ?"/>
    <managed editable="true"
             keepingHistory="true"
             canRunAdhoc="true"
             canDisable="true" />
  </trigger>

  <xwork key="configure-purge-attachments"
         name="Configure Purge Attachments">
    <package name="purge-attachments"
             extends="default"
             namespace="/admin/plugins/attachment-tools">
      <default-interceptor-ref name="defaultStack"/>
      <action name="configure"
              method="input"
              class="com.drunkendev.confluence.plugins.attachments.ConfigurePurgeAttachmentsAction">
        <result name="input" type="velocity">/templates/purge-attachments/config/configure-purge-attachments.vm</result>
        <result name="error" type="velocity">/templates/purge-attachments/config/configure-purge-attachments.vm</result>
        <result name="success" type="velocity">/templates/purge-attachments/config/configure-purge-attachments.vm</result>
      </action>
    </package>
  </xwork>

</atlassian-plugin>
